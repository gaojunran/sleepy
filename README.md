# Sleepy

ç¡ç€äº†å˜›ğŸ˜´ï¼Ÿåœ¨å¹²å˜›ï¼Ÿ

Sleepyå¯ä»¥è®°å½•ä½ çš„è®¾å¤‡çŠ¶æ€ï¼ˆæ‰‹æœºç”µé‡ï¼Œå‰å°åº”ç”¨â€¦â€¦ï¼‰ï¼Œå¹¶å®æ—¶å±•ç¤ºåœ¨é¡µé¢ä¸Šã€‚

æœ¬é¡¹ç›®åˆ›æ„æ¥è‡ªBç«™è§†é¢‘[æ”¹äº†ä¸ªèƒ½è®©å„ä½å®æ—¶è§†å¥¸æˆ‘çš„ç½‘ç«™](https://b23.tv/aHAUFFo)ï¼Œä½¿ç”¨Vue3 + Supabaseé‡æ„å®ç°ã€‚

![Screenshot](./public/Screenshot.png)

## å¦‚ä½•ä½¿ç”¨

### åœ¨çº¿ä½¿ç”¨

è®¿é—®[https://sleepy-nebula.netlify.app/].

### ä½¿ç”¨Netlifyå’ŒSupabaseè‡ªéƒ¨ç½²

å¦‚æœä½ æƒ³å€ŸåŠ©æˆ‘çš„æºç æ„å»ºä¸€ä¸ªè‡ªå·±çš„ç½‘ç«™ï¼Œå¯éµç…§ä»¥ä¸‹æ­¥éª¤ï¼š

#### **STEP 1** åœ¨Supabaseä¸­æ–°å»ºä¸€ä¸ªé¡¹ç›®

åˆ›å»ºä¸€ä¸ªåä¸º`records`çš„æ•°æ®åº“ï¼Œå¼€å¯`RLS`è®¤è¯ã€‚

å»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š

```sql
create table public.records (
  id bigint generated by default as identity not null,
  updated_at timestamp with time zone not null default now(),
  source smallint not null default '-1'::smallint,
  battery smallint not null default '-1'::smallint,
  app text null,
  constraint records_pkey primary key (id),
  constraint records_id_key unique (id)
) TABLESPACE pg_default;
```

Policyé…ç½®å¦‚ä¸‹ï¼šï¼ˆæ‚¨ä¹Ÿå¯ä»¥é…ç½®æ›´ç»†ç²’åº¦çš„æƒé™ï¼‰

```sql
alter policy "Enable access for all users"
on "public"."records"
to public
using (
  true
);
```

#### **STEP 2** åœ¨Netlifyä¸­éƒ¨ç½²æœ¬é¡¹ç›®ã€‚

æœ¬é¡¹ç›®é…ç½®å·²åœ¨[./netlify.toml](./netlify.toml)ä¸­è®¾ç½®å¥½ï¼›ä½ éœ€è¦åœ¨Netlifyä¸­é…ç½®ä¸Supabaseç›¸å…³çš„ç¯å¢ƒå˜é‡ï¼Œå¦‚ä¸‹ï¼š

```ini
VITE_SUPABASE_URL=
VITE_SUPABASE_ANON_KEY=
```

#### **STEP 3** æ‰‹æœºç›‘æ§ç«¯ï¼šåœ¨MacroDroidä¸­é…ç½®è§¦å‘å™¨ã€‚

å½“è§¦å‘å™¨ä¸ºã€Œåº”ç”¨ç¨‹åºæ‰“å¼€ï¼ˆæ‰€æœ‰åº”ç”¨ç¨‹åºï¼‰ã€æ—¶ï¼Œè§¦å‘åŠ¨ä½œï¼Œå‘é€ä»¥ä¸‹HTTPè¯·æ±‚ï¼š

```bash
curl --location --request POST '<VITE_SUPABASE_URL>/rest/v1/records' \
--header 'apikey: <VITE_SUPABASE_ANON_KEY>' \
--header 'Authorization: Bearer <VITE_SUPABASE_ANON_KEY>' \
--header 'Prefer: return=minimal' \
--header 'Content-Type: application/json' \
--data-raw '{"battery": "{battery}", "source": "1", "app": "{fg_app_name}"}'
```

å…¶ä¸­å°–æ‹¬å·å†…çš„å†…å®¹éœ€è¦æ‚¨è¿›è¡ŒåŠ¨æ€æ›¿æ¢ã€‚`{battery}`å’Œ`{fg_app_name}`åˆ†åˆ«è¡¨ç¤ºå½“å‰è®¾å¤‡ç”µé‡ä»¥åŠå‰å°åº”ç”¨åç§°ï¼Œå¯åœ¨MacroDroidä¸­é€šè¿‡è¿™æ ·çš„å¤§æ‹¬å·æ’å€¼å½¢å¼è·å–ã€‚

æ³¨æ„ï¼Œæ‚¨éœ€è¦ç»™MacroDroidæä¾›**æ— éšœç¢æƒé™å’Œã€Œæ— é™åˆ¶ã€çš„çœç”µé…ç½®**ï¼Œå¦åˆ™å¯èƒ½æ— æ³•è·å–æœ€åŠæ—¶çš„æ¶ˆæ¯ã€‚

#### **STEP 4** ç”µè„‘ç›‘æ§ç«¯ï¼šè¿è¡ŒPythonè„šæœ¬ã€‚

ä½ éœ€è¦åŒ…å«ç¯å¢ƒå˜é‡`VITE_SUPABASE_URL`å’Œ`VITE_SUPABASE_ANON_KEY`ï¼Œå¹¶ä½¿ç”¨æ¨èçš„`uv`æ¥è¿è¡Œå•æ–‡ä»¶Pythonè„šæœ¬ã€‚

```bash
export VITE_SUPABASE_URL=<VITE_SUPABASE_URL>
export VITE_SUPABASE_ANON_KEY=<VITE_SUPABASE_ANON_KEY>
uv run ./pc-monitor.py
```

è¿™å°†åœ¨ä½ çš„è®¾å¤‡ä¸Šæ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ä½ çš„çŠ¶æ€ã€‚å¦‚æœä½ æƒ³å®šåˆ¶å…¶å®ƒè§¦å‘é€»è¾‘ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹è„šæœ¬ã€‚

## å…¶å®ƒ

æœ¬é¡¹ç›®ä½¿ç”¨[Vitesse Lite](https://github.com/antfu/vitesse-lite)ä½œä¸ºæ¨¡æ¿ã€‚
